{
	auto_https off
	admin off
}

:80 {
	root * /srv
	header {
		# NOTE: Temporary relaxation â€” 'unsafe-eval' is required due to mediainfo.js using string eval in the worker.
		# TODO: Remove 'unsafe-eval' from script-src once upstream mediainfo.js patches this behavior.
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		Content-Security-Policy "default-src 'none'; base-uri 'none'; object-src 'none'; frame-ancestors 'none'; frame-src 'none'; form-action 'self'; manifest-src 'self'; worker-src 'self'; connect-src 'self'; img-src 'self' data: blob:; font-src 'self' data:; style-src 'self'; script-src 'self' 'wasm-unsafe-eval' 'unsafe-eval'; media-src 'self' blob:; upgrade-insecure-requests"
		Referrer-Policy "no-referrer"
		Permissions-Policy "autoplay=(self), fullscreen=(self), picture-in-picture=(), geolocation=(), microphone=(), camera=(), display-capture=(), screen-wake-lock=(), usb=(), serial=(), hid=(), midi=(), payment=(), accelerometer=(), gyroscope=(), magnetometer=(), clipboard-read=(), clipboard-write=(), idle-detection=(), encrypted-media=(), storage-access=(), attribution-reporting=(), browsing-topics=(), run-ad-auction=(), join-ad-interest-group=(), publickey-credentials-get=(), xr-spatial-tracking=(), gamepad=(), sync-xhr=(), local-fonts=(), otp-credentials=(), window-management=()"
		Cross-Origin-Embedder-Policy "require-corp"
		Cross-Origin-Resource-Policy "same-origin"
		Cross-Origin-Opener-Policy "same-origin"
		Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
	}

	# Restrict allowed HTTP methods to safe ones for static content
	@disallowed_methods {
		not method GET HEAD OPTIONS
	}
	header @disallowed_methods {
		Allow "GET, HEAD, OPTIONS"
	}
	respond @disallowed_methods 405

	file_server
	try_files {path} /index.html
}
